<div class="space-y-6">
  <!-- Header -->
  <div>
    <h2 class="text-xl font-black text-white">Mis Afiliados</h2>
    <p class="text-xs text-slate-400">Personas que se registraron con tu enlace de afiliado</p>
  </div>

  <!-- Código de afiliado + enlace -->
  <div class="bg-gradient-to-r from-primary/10 to-accent/10 border border-primary/20 rounded-2xl p-5">
    <div class="flex flex-col md:flex-row md:items-start justify-between gap-4">
      <div class="flex-1 space-y-4">
        <!-- Código -->
        <div>
          <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Tu Código de Afiliado</p>
          <div class="flex items-center gap-2">
            <code class="bg-black/40 px-3 py-1.5 rounded-lg font-mono text-base text-primary border border-primary/20">
              {{ profile()?.referral_code || '—' }}
            </code>
            <button
              class="p-1.5 bg-white/10 hover:bg-white/20 rounded-lg transition-all"
              (click)="copyToClipboard(profile()?.referral_code || '')"
              title="Copiar código"
            >
              <span class="material-icons text-sm text-slate-300" style="font-size:16px;">content_copy</span>
            </button>
          </div>
        </div>
        <!-- Enlace -->
        <div>
          <p class="text-[10px] text-slate-400 uppercase font-bold mb-1">Tu Enlace de Afiliado</p>
          <div class="flex items-center gap-2">
            <span class="bg-black/40 px-3 py-1.5 rounded-lg font-mono text-xs text-slate-300 border border-white/10 truncate max-w-xs block">
              {{ profile()?.referral_link || '—' }}
            </span>
            <button
              class="p-1.5 bg-white/10 hover:bg-white/20 rounded-lg transition-all flex-shrink-0"
              (click)="copyToClipboard(profile()?.referral_link || '')"
              title="Copiar enlace"
            >
              <span class="material-icons text-sm text-slate-300" style="font-size:16px;">content_copy</span>
            </button>
          </div>
        </div>
      </div>
      <!-- Total afiliados -->
      <div class="flex flex-col items-center justify-center bg-black/30 rounded-xl px-6 py-4 border border-white/10 min-w-[100px]">
        <span class="material-icons text-primary mb-1" style="font-size:28px;">group</span>
        <p class="text-2xl font-black text-white">{{ totalAfiliados() }}</p>
        <p class="text-[10px] text-slate-400 uppercase font-bold text-center">Afiliados</p>
      </div>
    </div>
  </div>

  <!-- Stats row -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div class="bg-card-dark border border-white/5 rounded-xl p-4 text-center">
      <p class="text-2xl font-black text-white">{{ totalAfiliados() }}</p>
      <p class="text-[10px] text-slate-400 uppercase font-bold mt-1">Total Afiliados</p>
    </div>
    <div class="bg-card-dark border border-white/5 rounded-xl p-4 text-center">
      <p class="text-2xl font-black text-amber-400">
        {{ afiliadosConPaquete() }}
      </p>
      <p class="text-[10px] text-slate-400 uppercase font-bold mt-1">Con Paquete Activo</p>
      <span class="inline-block mt-1 px-2 py-0.5 rounded-full bg-amber-500/10 text-amber-400 text-[10px] font-bold border border-amber-500/20">activos</span>
    </div>
    <div class="bg-card-dark border border-white/5 rounded-xl p-4 text-center">
      <p class="text-2xl font-black text-primary">
        {{ formatCOP(profile()?.referral_earnings || 0) }}
      </p>
      <p class="text-[10px] text-slate-400 uppercase font-bold mt-1">Ganancias Afiliados</p>
    </div>
  </div>

  <!-- Lista de afiliados -->
  @if (loading()) {
    <div class="flex items-center justify-center py-16">
      <div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
    </div>
  } @else if (afiliados().length === 0) {
    <div class="bg-card-dark border border-white/5 rounded-2xl p-10 flex flex-col items-center justify-center gap-3 text-center">
      <span class="material-icons text-slate-600" style="font-size:48px;">group</span>
      <p class="text-white font-bold text-base">Aún no tienes afiliados</p>
      <p class="text-slate-400 text-sm max-w-xs">
        Comparte tu enlace para empezar a ganar. Cuando alguien se registre con tu código, aparecerá aquí.
      </p>
    </div>
  } @else {
    <div class="space-y-3">
      <h3 class="text-sm font-bold text-slate-300 uppercase tracking-wider">Lista de Afiliados</h3>
      @for (afiliado of afiliados(); track afiliado.id) {
        <div class="bg-card-dark border border-white/5 rounded-xl p-4 flex items-center gap-4">
          <!-- Avatar -->
          @if (afiliado.avatar_url) {
            <img
              [src]="afiliado.avatar_url"
              [alt]="afiliado.username"
              class="w-11 h-11 rounded-full object-cover flex-shrink-0 border border-white/10"
            />
          } @else {
            <div
              class="w-11 h-11 rounded-full bg-gradient-to-tr from-primary to-accent flex items-center justify-center flex-shrink-0 text-black font-black text-sm uppercase"
            >
              {{ afiliado.username.charAt(0) }}
            </div>
          }

          <!-- Info -->
          <div class="flex-1 min-w-0">
            <p class="text-white font-bold text-sm truncate">
              {{ afiliado.full_name || afiliado.username }}
            </p>
            <p class="text-slate-500 text-xs">&#64;{{ afiliado.username }}</p>
            <div class="flex items-center gap-2 mt-1 flex-wrap">
              <!-- Nivel -->
              <span
                class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold"
                [ngClass]="getLevelColor(afiliado.level)"
              >
                Nv. {{ afiliado.level }}
              </span>
              <!-- Paquete -->
              @if (afiliado.has_active_package) {
                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-bold bg-amber-500/10 text-amber-400 border border-amber-500/20">
                  <span class="material-icons" style="font-size:10px;">workspace_premium</span>
                  Paquete Activo
                </span>
              } @else {
                <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold bg-slate-700 text-slate-400">
                  Sin Paquete
                </span>
              }
            </div>
          </div>

          <!-- Fecha -->
          <div class="text-right flex-shrink-0">
            <p class="text-xs text-slate-400">{{ getTimeAgo(afiliado.created_at) }}</p>
          </div>
        </div>
      }
    </div>
  }
</div>
