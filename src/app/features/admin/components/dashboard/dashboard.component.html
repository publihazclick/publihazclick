<div class="space-y-6 lg:space-y-8">
  <!-- Loading State -->
  @if (loading()) {
    <div class="flex flex-col items-center justify-center py-20">
      <span class="material-icons text-primary w-10 h-10 animate-spin mb-4">sync</span>
      <p class="text-slate-400 text-sm font-medium">Cargando datos...</p>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="bg-rose-500/10 border border-rose-500/20 rounded-xl p-6 text-center">
      <span class="material-icons text-rose-500 w-10 h-10 mx-auto mb-3">error</span>
      <p class="text-rose-500 font-medium mb-3">{{ error() }}</p>
      <button
        (click)="reloadData()"
        class="px-4 py-2 bg-rose-500 hover:bg-rose-600 text-white rounded-lg text-sm font-medium transition-colors"
      >
        Reintentar
      </button>
    </div>
  }

  @if (!loading() && !error()) {
    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 lg:gap-6">
      <!-- Total Users -->
      <div class="bg-white dark:bg-card-dark p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
        <div class="flex items-start justify-between mb-4">
          <div class="p-2 bg-blue-500/10 text-blue-500 rounded-lg">
            <span class="material-icons text-blue-500 w-5 h-5">group</span>
          </div>
          <div class="flex items-center gap-1 text-emerald-500 text-xs font-bold">
            <span class="material-icons text-emerald-500 w-3 h-3">trending_up</span> +{{ stats()?.newUsersToday || 0 }}
          </div>
        </div>
        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Total Usuarios</h3>
        <div class="flex items-baseline gap-2">
          <span class="text-3xl font-black">{{ formatNumber(stats()?.totalUsers) }}</span>
          <div class="flex items-end gap-0.5 h-8">
            <div class="w-1 bg-blue-500/20 h-3 rounded-full"></div>
            <div class="w-1 bg-blue-500/20 h-5 rounded-full"></div>
            <div class="w-1 bg-blue-500 h-8 rounded-full"></div>
            <div class="w-1 bg-blue-500 h-6 rounded-full"></div>
          </div>
        </div>
      </div>

      <!-- Active Ads -->
      <div class="bg-white dark:bg-card-dark p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
        <div class="flex items-start justify-between mb-4">
          <div class="p-2 bg-primary/10 text-primary rounded-lg">
            <span class="material-icons text-primary w-5 h-5">ads_click</span>
          </div>
          <div class="flex items-center gap-1 text-emerald-500 text-xs font-bold">
            <span class="material-icons text-emerald-500 w-3 h-3">trending_up</span> Activo
          </div>
        </div>
        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Anuncios Activos</h3>
        <div class="flex items-baseline gap-2">
          <span class="text-3xl font-black">{{ formatNumber(stats()?.activeAds) }}</span>
          <span class="text-xs text-slate-400">/ {{ formatNumber(stats()?.totalAds) }}</span>
          <div class="flex items-end gap-0.5 h-8">
            <div class="w-1 bg-primary/20 h-4 rounded-full"></div>
            <div class="w-1 bg-primary/20 h-8 rounded-full"></div>
            <div class="w-1 bg-primary h-6 rounded-full"></div>
            <div class="w-1 bg-primary h-7 rounded-full"></div>
          </div>
        </div>
      </div>

      <!-- Total Revenue -->
      <div class="bg-white dark:bg-card-dark p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
        <div class="flex items-start justify-between mb-4">
          <div class="p-2 bg-emerald-500/10 text-emerald-500 rounded-lg">
            <span class="material-icons text-emerald-500 w-5 h-5">attach_money</span>
          </div>
          <div class="flex items-center gap-1 text-emerald-500 text-xs font-bold">
            <span class="material-icons text-emerald-500 w-3 h-3">trending_up</span> Hoy
          </div>
        </div>
        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Ingresos Totales (COP)</h3>
        <div class="flex items-baseline gap-2">
          <span class="text-2xl font-black">{{ formatCurrency(stats()?.totalRevenue) }}</span>
          <div class="flex items-end gap-0.5 h-8">
            <div class="w-1 bg-emerald-500/20 h-7 rounded-full"></div>
            <div class="w-1 bg-emerald-500 h-5 rounded-full"></div>
            <div class="w-1 bg-emerald-500/20 h-3 rounded-full"></div>
            <div class="w-1 bg-emerald-500 h-6 rounded-full"></div>
          </div>
        </div>
      </div>

      <!-- Pending Withdrawals -->
      <div class="bg-white dark:bg-card-dark p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
        <div class="flex items-start justify-between mb-4">
          <div class="p-2 bg-amber-500/10 text-amber-500 rounded-lg">
            <span class="material-icons text-amber-500 w-5 h-5">schedule</span>
          </div>
          <div class="bg-amber-100 dark:bg-amber-900/30 text-amber-600 text-[10px] px-2 py-0.5 rounded-full font-bold">
            {{ stats()?.pendingWithdrawals || 0 }}
          </div>
        </div>
        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Retiros Pendientes</h3>
        <div class="flex items-baseline gap-2">
          <span class="text-3xl font-black">{{ formatNumber(stats()?.pendingWithdrawals) }}</span>
          <div class="flex items-end gap-0.5 h-8">
            <div class="w-1 bg-amber-500/20 h-3 rounded-full"></div>
            <div class="w-1 bg-amber-500 h-6 rounded-full"></div>
            <div class="w-1 bg-amber-500 h-8 rounded-full"></div>
            <div class="w-1 bg-amber-500/20 h-5 rounded-full"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts and Tables -->
    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 lg:gap-8">
      <!-- System Activity Chart -->
      <div class="xl:col-span-2 space-y-6 lg:space-y-8">
        <div class="bg-white dark:bg-card-dark p-4 lg:p-8 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
          <div class="flex items-center justify-between mb-8">
            <div>
              <h3 class="font-bold text-lg">Actividad del Sistema</h3>
              <p class="text-xs text-slate-400 font-medium">Usuarios nuevos vs Clicks en anuncios (Últimos 7 días)</p>
            </div>
          </div>

          @if (chartData(); as chart) {
            <div class="h-48 lg:h-64 flex items-end justify-between gap-2 lg:gap-4 px-2">
              @for (label of chart.labels; track $index; let i = $index) {
                <div class="flex-1 flex flex-col items-center gap-2 group">
                  <div class="w-full flex gap-1 items-end justify-center h-full">
                    @if (chart.datasets[0]; as dataset) {
                      @let maxVal = (dataset.data | max);
                      @let height1 = getBarHeight(dataset.data[i] || 0, maxVal || 1);
                      <div class="w-3 bg-cyan-500/40 rounded-t" [style.height]="height1"></div>
                    }
                    @if (chart.datasets[1]; as dataset) {
                      @let maxVal = (dataset.data | max);
                      @let height2 = getBarHeight(dataset.data[i] || 0, maxVal || 1);
                      <div class="w-3 bg-pink-500 rounded-t" [style.height]="height2"></div>
                    }
                  </div>
                  <span class="text-[10px] font-bold text-slate-400">{{ label }}</span>
                </div>
              }
            </div>
            <div class="mt-8 flex gap-6 pt-6 border-t border-slate-100 dark:border-white/5">
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-cyan-500/40"></span>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Usuarios</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-pink-500"></span>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Clicks</span>
              </div>
            </div>
          } @else {
            <div class="h-48 lg:h-64 flex items-center justify-center">
              <p class="text-slate-400 text-sm">No hay datos disponibles</p>
            </div>
          }
        </div>

        <!-- Pending Moderation Table -->
        <div class="bg-white dark:bg-card-dark rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm overflow-hidden">
          <div class="p-4 lg:p-6 border-b border-slate-100 dark:border-white/5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
              <h3 class="font-bold text-lg">Moderación Pendiente</h3>
              <p class="text-xs text-slate-400">Revisar campañas pendientes de aprobación</p>
            </div>
            <a routerLink="/admin/moderation" class="text-primary text-xs font-bold uppercase hover:underline">Ver Todo</a>
          </div>

          @if (hasPendingAds()) {
            <div class="overflow-x-auto">
              <table class="w-full text-left">
                <thead>
                  <tr class="bg-slate-50 dark:bg-white/5 text-[10px] font-black uppercase text-slate-500 tracking-widest">
                    <th class="px-3 lg:px-6 py-3 lg:py-4">Campaña</th>
                    <th class="px-3 lg:px-6 py-3 lg:py-4 hidden sm:table-cell">Anunciante</th>
                    <th class="px-3 lg:px-6 py-3 lg:py-4 hidden md:table-cell">Tipo</th>
                    <th class="px-3 lg:px-6 py-3 lg:py-4">Estado</th>
                    <th class="px-3 lg:px-6 py-3 lg:py-4 text-right">Acciones</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-slate-100 dark:divide-white/5">
                  @for (item of pendingItems(); track item.id) {
                    <tr class="group hover:bg-slate-50 dark:hover:bg-white/5 transition-colors">
                      <td class="px-3 lg:px-6 py-3 lg:py-4">
                        <div class="flex items-center gap-2 lg:gap-3">
                          <div class="w-8 h-8 lg:w-10 lg:h-10 rounded-lg bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center flex-shrink-0">
                            <span class="material-icons text-primary w-4 h-4">language</span>
                          </div>
                          <div class="min-w-0">
                            <div class="text-sm font-bold truncate">{{ item.title }}</div>
                            <div class="text-[10px] text-slate-400 hidden sm:block">ID: {{ item.id | slice:0:8 }}</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-3 lg:px-6 py-3 lg:py-4 hidden sm:table-cell">
                        <div class="text-sm font-medium">{{ item.advertiser_username }}</div>
                        <div class="text-[10px] text-slate-400">{{ formatDate(item.submitted_at) }}</div>
                      </td>
                      <td class="px-3 lg:px-6 py-3 lg:py-4 text-xs font-medium text-slate-500 hidden md:table-cell capitalize">
                        {{ item.type }}
                      </td>
                      <td class="px-3 lg:px-6 py-3 lg:py-4">
                        <span class="px-2 py-1 bg-amber-500/10 text-amber-500 rounded text-[10px] font-bold uppercase tracking-tight">Pendiente</span>
                      </td>
                      <td class="px-3 lg:px-6 py-3 lg:py-4 text-right">
                        <div class="flex justify-end gap-1 lg:gap-2">
                          <button
                            (click)="rejectAd(item.id)"
                            class="p-1.5 lg:p-2 text-rose-500 hover:bg-rose-500/10 rounded-lg transition-colors"
                            title="Rechazar"
                          >
                            <span class="material-icons text-rose-500 w-3.5 lg:w-4 h-3.5 lg:h-4">close</span>
                          </button>
                          <button
                            (click)="approveAd(item.id)"
                            class="p-1.5 lg:p-2 text-emerald-500 hover:bg-emerald-500/10 rounded-lg transition-colors"
                            title="Aprobar"
                          >
                            <span class="material-icons text-emerald-500 w-3.5 lg:w-4 h-3.5 lg:h-4">check</span>
                          </button>
                        </div>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="p-8 text-center">
              <div class="w-16 h-16 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="material-icons text-emerald-500 w-8 h-8">check</span>
              </div>
              <h4 class="font-bold text-lg mb-2">¡Todo al día!</h4>
              <p class="text-slate-400 text-sm">No hay campañas pendientes de moderación</p>
            </div>
          }
        </div>
      </div>

      <!-- Sidebar widgets -->
      <div class="space-y-4 lg:space-y-8">
        <!-- Recent Activity -->
        <div class="bg-white dark:bg-card-dark p-4 lg:p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
          <h3 class="font-bold text-base lg:text-lg mb-4">Actividad Reciente</h3>

          @if (recentActivity().length > 0) {
            <div class="space-y-4">
              @for (activity of recentActivity(); track activity.id) {
                <div class="flex gap-3">
                  <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                    <span class="material-icons text-primary w-4 h-4">language</span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium truncate">
                      {{ activity.username }}
                    </p>
                    <p class="text-xs text-slate-400">
                      {{ getActionText(activity.action) }}
                    </p>
                    <p class="text-[10px] text-slate-500 mt-1">
                      {{ formatDate(activity.created_at) }}
                    </p>
                  </div>
                </div>
              }
            </div>
          } @else {
            <p class="text-slate-400 text-sm text-center py-4">No hay actividad reciente</p>
          }

          <a routerLink="/admin/logs" class="w-full mt-6 py-3 bg-slate-50 dark:bg-white/5 hover:bg-primary hover:text-black rounded-xl text-xs font-bold uppercase tracking-wider transition-all border border-slate-200 dark:border-white/10 text-center block">
            Ver todos los logs
          </a>
        </div>

        <!-- Revenue Summary -->
        <div class="bg-gradient-to-br from-sidebar-dark to-slate-900 p-4 lg:p-8 rounded-2xl text-white shadow-xl">
          <div class="flex items-center gap-2 lg:gap-3 mb-4 lg:mb-6">
            <span class="material-icons text-primary w-4 lg:w-5 h-4 lg:h-5">language</span>
            <h3 class="font-bold text-sm lg:text-base">Resumen del Sistema</h3>
          </div>
          <div class="space-y-4 mb-4 lg:mb-6">
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-400">Usuarios activos</span>
              <span class="text-sm font-bold text-emerald-400">{{ formatNumber(stats()?.activeUsers) }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-400">Anuncios pendientes</span>
              <span class="text-sm font-bold text-amber-400">{{ formatNumber(stats()?.pendingAds) }}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-xs text-slate-400">Retiros completados</span>
              <span class="text-sm font-bold text-blue-400">{{ formatNumber(stats()?.totalWithdrawals) }}</span>
            </div>
          </div>
          <div class="bg-white/5 p-4 rounded-xl">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-bold">Ingresos hoy</span>
              <span class="text-sm font-bold text-primary">{{ formatCurrency(stats()?.todayRevenue) }}</span>
            </div>
            <div class="w-full bg-white/10 rounded-full h-2">
              <div class="bg-primary rounded-full h-2" [style.width.%]="Math.min((stats()?.todayRevenue || 0) / 100000 * 100, 100)"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>
